{% extends "base.html" %}
{% block headcss %}
    <link rel="stylesheet" href="/static/lib/leaflet/leaflet.css" type="text/css">
    <link rel="stylesheet" href="/static/lib/fwo/maps.css" type="text/css">
{% endblock %}
{% block footjs %}


  <script type="text/javascript" src="/static/lib/leaflet/leaflet.js"></script>
  <script type="text/javascript" src="/static/lib/fwo/fieldworkonline-map.js"></script>
  <script type="text/javascript" src="/static/lib/fwo/fieldworkonline-feedback.js"></script>
  <script src="https://www.mapquestapi.com/sdk/leaflet/v2.2/mq-map.js?key=Rb8mk6WhnRbq72GpHLRGXnkX5u35Ou3K "></script>
  <script type="text/javascript">
        $(document).ready(function(){
            /*
            Set some init values that will be used by FWO.map.init()
            */

            /*
            Fetch the map layers from the JSON document generated by the project_data_maplayers
            view.
            */
            FWO.map.fetch_map("{{url_for('project_data_maplayers', slug=project.slug, user_id=user.id)}}")

        })
    </script>
{% endblock %}

{% block maps %}
    <div class="container-fluid">
        <div class="row" style="background-color:#fff;">
          <div class="col-md-3 col-sm-3">
          <div class="panel-group" id="accordion">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <i class="fa fa-fw fa-bars"></i>
                  <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne"><strong>Uploaded Data</strong></a>
                  <!--
                  <a data-zoom-to-extent="" href="#" id="zoom-to-project-extent" class="zoom-to-extent pull-right">Reset zoom <i class="fa fa-arrows"></i></a>-->
                </h4>


              </div>
              <div id="collapseOne" class="panel-collapse collapse in" >

                <ul class="list-group" id="map-layers">

                {% if observationlayers | length > 0 %}
                <li class="list-group-item">
                    <i class="fa fa-folder-open fa-fw"></i> Observations
                    <ul class="list-group" id="userdata-layers">
                    {% for observationlayer in observationlayers %}
                      <li id="userdata-layers-{{observationlayer.safe_name}}" class="list-group-item wms-layer wms-layer-visible" data-layer-name="{{observationlayer.safe_name}}" data-layer-color="{{observationlayer.color}}"  data-layer-geojson="{{ url_for('project_data_layer', slug=project.slug, user_id=user.id, safe_name=observationlayer.safe_name) }}">
                        <a href="#" class="layer-visibility-toggle" title="Toggle visibility">
                          <i class="fa fa-toggle-on fa-fw"></i>&nbsp;{{observationlayer.name}}
                        </a>
                        <a class="zoom-to-extent pull-right" style="text-decoration:none;cursor:hand;">
                          <span style="color:{{observationlayer.color}};"><i class="fa fa-circle" style="color:{{observationlayer.color}};"></i></span>
                          <i data-original-title="Zoom to layer" class="fa fa-search" data-toggle="tooltip" data-placement="left" title=""></i>
                        </a>
                      </li>
                    {% endfor %}
                    </ul>
                </li>
                {% else %}
                <li class="list-group-item">
                  <small>No observations have been uploaded yet into this workspace.</small>
                </li>
                {% endif %}



                </ul>

              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <i class="fa fa-fw fa-bars"></i>
                  <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour"><strong>Background Layers</strong></a>
                </h4>
              </div>
              <div id="collapseFour" class="panel-collapse collapse">

                <ul class="list-group" id="background-layers">
                    <li class="list-group-item"><i style="color:#000;" class="fa fa-folder-open fa-fw" ></i> Project Data</li>
                    {% if project.backgroundlayers|length > 0%}
                      {% for layer in project.backgroundlayers %}
                      <li class="list-group-item" id="background-layer-{{layer.name}}"><i class="fa fa-check fa-fw"></i> <a href="#" class="set-background-layer" data-set-background-layer="{{layer.name}}">{{layer.name}}</a></li>
                      {% endfor %}
                    {% else %}
                      <li class="list-group-item"><small>No additional data layers have been uploaded in this project. Please use the global maps as backgrounds.</small></li>
                    {% endif %}
                    <li class="list-group-item"><i style="color:#000;" class="fa fa-folder-open fa-fw" ></i> Global Maps</li>
                    <li class="list-group-item" id="background-layer-sat"><i class="fa fa-check fa-fw"></i> <a href="#" class="set-background-layer" data-set-background-layer="sat">Mapquest Satellite</a></li>
                    <li class="list-group-item" id="background-layer-map"><i class="fa fa-check fa-fw"></i> <a href="#" class="set-background-layer" data-set-background-layer="map">Mapquest Road</a></li>

                </ul>
              </div>
            </div>

          </div>
          </div>

          <!--
            HTML Elements for the Leaflet map.
          -->
          <div class="col-md-9 col-sm-9" style="padding-right:0px;padding-left:0;">
            <div id="map" class="map">

            </div>
          </div>
    </div>
    {% include "feedback.html" %}
    {% include "photomodal.html" %}
{% endblock %}
